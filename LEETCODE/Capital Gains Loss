SELECT DISTINCT stock_name, sum(case when operation = 'SELL' then price
ELSE 0 END) -
SUM(CASE WHEN operation = 'BUY' THEN price ELSE 0 END) as capital_gain_loss
FROM Stocks
GROUP BY stock_name
